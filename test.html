<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Code Runner</title>
    <!-- CodeMirror CSS and JS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/monokai.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/skulpt/dist/skulpt.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/skulpt/dist/skulpt-stdlib.js"></script>

<script src="https://cdn.jsdelivr.net/npm/split.js/dist/split.min.js"></script>
    <link rel="stylesheet" href="assets/css/lessons.css">
    
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <a href="index.html"><img src="assets/img/logo/Locked-In-12-25-2024.png" alt="locked in logo" height="60px"></a>
            </div>
            <nav>
                <ul id="lesson-navbar">
                    <li class="active" ><a href="index.html">Home</a></li>
                    <li><a href="courses.html">Subjects</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="#">Curriculum</a></li>
                    
                </ul>
                <div class="profile-div">
                    <img src="profile_image.png" id="profile-pic">
                </div>
            </nav>
        </div>
    </header>

        <div id="container">
            <div id="instruction-pane">
                <h3>Lesson 1</h3>
            </div>
            <div id="editor-pane">
                <div id="editor"></div>
                <button id="run-code" onclick="runCode()">Run Code</button> <!-- Button to run the code -->
            </div>   
            <div id="output-pane">
                <pre id="output-text"></pre>
            </div>
        </div>

 <footer>
    <div class="footer-container">
        <nav><ul class="foot-nav">
            <li><button id="previous-button" onClick="goToPreviousLesson()" disabled>Previous</button></li>
            <li><button id="continue-button" onclick="goToNextLesson()" disabled>Continue</button></li>
        </ul></nav>
    </div>
</footer>  
<script>
        // Initialize the Split.js layout
        Split(['#instruction-pane', '#editor-pane', '#output-pane'], {
            sizes: [33, 34, 33],
            gutterSize: 5,
            minSize: 20,
            onDrag: () => editor.refresh(),
        });

        // Initialize CodeMirror editor
        const editor = CodeMirror(document.getElementById("editor"), {
            value: "# Write your Python code here\nprint('Hello, world!')",
            mode: "python",
            theme: "monokai",
            lineNumbers: true,
        });
        editor.setSize("100%", "100%");

        const expectedOutput = "Hello, world!"; // Expected result for this lesson
        let currentLesson = 1;  // Starting lesson number
        const totalLessons = 5; // Total number of lessons
        let isTaskCompleted = false; // Task completion state

        // Update button states based on lesson and task status
        function updateButtonState() {
            const previousBtn = document.getElementById('previous-button');
            const continueBtn = document.getElementById('continue-button');

            // Enable/disable "Previous" button
            previousBtn.disabled = currentLesson <= 1;

            // Enable/disable "Continue" button
            continueBtn.disabled = !isTaskCompleted;
        }

        // Mark the task as completed and enable the "Continue" button
        function markTaskAsCompleted() {
            isTaskCompleted = true;
            updateButtonState();
        }

        // Move to the next lesson
        function goToNextLesson() {
            if (currentLesson < totalLessons) {
                currentLesson++;
                isTaskCompleted = false; // Reset task completion for the new lesson
                updateButtonState();
                // Add code to load the next lesson content here
            }
        }

        // Move to the previous lesson
        function goToPreviousLesson() {
            if (currentLesson > 1) {
                currentLesson--;
                isTaskCompleted = false; // Reset task completion for the new lesson
                updateButtonState();
                // Add code to load the previous lesson content here
            }
        }

        // Run the user's code and check its output
        function runCode() {
    const code = editor.getValue();
    const outputText = document.getElementById("output-text");
    outputText.textContent = ""; // Clear previous output

    Sk.configure({
        output: (text) => {
            outputText.textContent += text; // Append output to the output pane
        },
        read: (x) => {
            if (Sk.builtinFiles === undefined || !Sk.builtinFiles["files"][x]) {
                throw `File not found: '${x}'`;
            }
            return Sk.builtinFiles["files"][x];
        },
    });

    Sk.misceval
        .asyncToPromise(() => Sk.importMainWithBody("<stdin>", false, code))
        .then(() => {
            const userOutput = outputText.textContent.trim();
            if (userOutput === expectedOutput) {
                outputText.textContent += "\n✅ Correct! Great job!";
                markTaskAsCompleted();
            } else {
                outputText.textContent += `\n❌ Incorrect. Expected: "${expectedOutput}"`;
            }
        })
        .catch((err) => {
            outputText.textContent = `Error: ${err.toString()}`;
        });
}

        // Initialize button state on page load
        window.onload = updateButtonState;
    // Add an event listener for keyboard shortcuts
document.addEventListener("keydown", function (event) {
    if (event.ctrlKey && event.key === "Enter") {
        event.preventDefault(); // Prevent default browser behavior
        runCode(); // Call the runCode function
    }
});
    </script>
</body>
</html>